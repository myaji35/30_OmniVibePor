(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[604],{388:function(e,t,r){Promise.resolve().then(r.bind(r,6524))},6524:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var s=r(3827),l=r(4090);let a={projectId:null,projectTitle:null,projectTopic:null,platform:null,currentStep:"writer",script:null,audio:null,video:null,isLoading:!1,error:null,progress:0};function n(e,t){switch(t.type){case"SET_PROJECT":return{...e,projectId:t.payload.projectId,projectTitle:t.payload.title,projectTopic:t.payload.topic,platform:t.payload.platform,progress:10};case"SET_STEP":return{...e,currentStep:t.payload,error:null};case"SET_SCRIPT":return{...e,script:t.payload,currentStep:"director",progress:35};case"SET_AUDIO":return{...e,audio:t.payload,progress:60};case"SET_VIDEO":return{...e,video:t.payload,progress:85};case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload,isLoading:!1};case"SET_PROGRESS":return{...e,progress:Math.min(100,Math.max(0,t.payload))};case"RESET_PRODUCTION":return a;default:return e}}let o=(0,l.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,l.useReducer)(n,a),i=(0,l.useCallback)((e,t,r,s)=>{c({type:"SET_PROJECT",payload:{projectId:e,title:t,topic:r,platform:s}})},[]),d=(0,l.useCallback)(e=>{c({type:"SET_STEP",payload:e})},[]),u=(0,l.useCallback)(e=>{c({type:"SET_SCRIPT",payload:e})},[]),m=(0,l.useCallback)(e=>{c({type:"SET_AUDIO",payload:e})},[]),x=(0,l.useCallback)(e=>{c({type:"SET_VIDEO",payload:e})},[]),p=(0,l.useCallback)(e=>{c({type:"SET_LOADING",payload:e})},[]),h=(0,l.useCallback)(e=>{c({type:"SET_ERROR",payload:e})},[]),g=(0,l.useCallback)(e=>{c({type:"SET_PROGRESS",payload:e})},[]),b=(0,l.useCallback)(()=>{c({type:"RESET_PRODUCTION"})},[]),j=null!==r.script,f=null!==r.audio&&null!==r.video;return(0,s.jsx)(o.Provider,{value:{state:r,setProject:i,setStep:d,setScript:u,setAudio:m,setVideo:x,setLoading:p,setError:h,setProgress:g,resetProduction:b,canProceedToDirector:j,canProceedToMarketer:f,canProceedToDeployment:f},children:t})}function i(){let e=(0,l.useContext)(o);if(void 0===e)throw Error("useProduction must be used within a ProductionProvider");return e}function d(){let{state:e,setScript:t,setStep:r,setLoading:a,setError:n}=i(),[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(0),[m,x]=(0,l.useState)(0),[p,h]=(0,l.useState)(!1),[g,b]=(0,l.useState)(null);(0,l.useEffect)(()=>{e.script&&c(e.script.content)},[e.script]),(0,l.useEffect)(()=>{let e=o.length;u(e),x(Math.ceil(e/200*60))},[o]),(0,l.useEffect)(()=>{if(!o.trim())return;let e=setTimeout(()=>{j()},5e3);return()=>clearTimeout(e)},[o]);let j=(0,l.useCallback)(async()=>{if(o.trim()){h(!0);try{b(new Date)}catch(e){console.error("Failed to save script:",e)}finally{h(!1)}}},[o,d,m]),f=async()=>{if(!o.trim()){n("스크립트를 입력하세요");return}a(!0),n(null);try{if(!e.projectId)throw Error("프로젝트가 선택되지 않았습니다");let s=await fetch("http://localhost:8000/api/v1/projects/".concat(e.projectId,"/scripts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o,platform:e.platform||"youtube",word_count:d,estimated_duration:m})});if(!s.ok)throw Error("Failed to save script");let l=await s.json();t(l),r("director")}catch(e){n(e.message),console.error("Failed to proceed to director:",e)}finally{a(!1)}};return(0,l.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"s"===e.key&&(e.preventDefault(),j()),(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),f())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[j,f]),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"스크립트 작성"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"영상에 사용할 스크립트를 작성하세요"})]}),(0,s.jsxs)("div",{className:"flex gap-6 text-sm",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:d}),(0,s.jsx)("div",{className:"text-gray-600",children:"글자"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[Math.floor(m/60),":",(m%60).toString().padStart(2,"0")]}),(0,s.jsx)("div",{className:"text-gray-600",children:"예상 시간"})]})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("textarea",{value:o,onChange:e=>c(e.target.value),placeholder:"여기에 스크립트를 입력하세요...  예: 안녕하세요! 오늘은 건강한 식습관에 대해 이야기해보려고 합니다.  첫 번째로, 아침 식사의 중요성입니다... ",className:"w-full h-[500px] px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none font-mono text-sm"}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2 text-xs text-gray-500",children:[(0,s.jsxs)("div",{children:[p&&"저장 중...",!p&&g&&"마지막 저장: ".concat(g.toLocaleTimeString("ko-KR")),!p&&!g&&"자동 저장 (5초마다)"]}),(0,s.jsxs)("div",{className:"text-gray-400",children:[(0,s.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"⌘S"})," 저장 |"," ",(0,s.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"⌘Enter"})," 다음"]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("button",{onClick:j,disabled:p||!o.trim(),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"저장 중...":"저장"}),(0,s.jsx)("button",{onClick:f,disabled:!o.trim()||e.isLoading,className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center gap-2",children:e.isLoading?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"처리 중..."]}):(0,s.jsxs)(s.Fragment,{children:["다음: 오디오 생성",(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]}),(0,s.jsxs)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"\uD83D\uDCA1 팁"}),(0,s.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,s.jsx)("li",{children:"• 스크립트는 자동으로 5초마다 저장됩니다"}),(0,s.jsx)("li",{children:"• 한국어 기준 분당 약 200자가 읽힙니다"}),(0,s.jsx)("li",{children:"• 구두점(마침표, 쉼표)을 적절히 사용하면 자연스러운 음성이 생성됩니다"}),(0,s.jsx)("li",{children:'• "다음" 버튼을 클릭하면 자동으로 오디오 생성 단계로 이동합니다'})]})]})]})}var u=r(8716);let m=[{id:"rachel",name:"Rachel",language:"en",description:"밝고 친근한 여성 목소리"},{id:"adam",name:"Adam",language:"en",description:"차분하고 신뢰감 있는 남성 목소리"},{id:"aria",name:"Aria",language:"ko",description:"자연스러운 한국어 여성 목소리"},{id:"josh",name:"Josh",language:"en",description:"에너지 넘치는 젊은 남성 목소리"}];function x(){let{state:e,setAudio:t,setError:r,setLoading:a,setProgress:n}=i(),[o,c]=(0,l.useState)("aria"),[d,x]=(0,l.useState)(!1),[p,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{e.script||r("스크립트가 없습니다. Writer 단계로 돌아가세요.")},[e.script]);let g=async()=>{if(!e.script||!e.projectId){r("스크립트 또는 프로젝트 정보가 없습니다");return}x(!0),r(null),a(!0),n(40);try{let t=await fetch("http://localhost:8000/api/v1/projects/".concat(e.projectId,"/audio"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script_id:e.script.script_id,voice_id:o,accuracy_threshold:.95,max_attempts:5})});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to generate audio")}let r=await t.json();h(r.task_id)}catch(e){r(e.message),x(!1),a(!1),console.error("Failed to generate audio:",e)}};return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"오디오 & 비디오 생성"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"스크립트를 오디오와 비디오로 변환합니다"})]}),e.script&&(0,s.jsxs)("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"스크립트"}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[e.script.word_count,"자 | ",Math.floor(e.script.estimated_duration/60),"분"," ",e.script.estimated_duration%60,"초"]})]}),(0,s.jsx)("p",{className:"text-gray-700 text-sm whitespace-pre-wrap line-clamp-4",children:e.script.content})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83C\uDF99️ 오디오 생성"}),!e.audio&&!d&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"음성 선택"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:m.map(e=>(0,s.jsxs)("button",{onClick:()=>c(e.id),className:"p-4 border rounded-lg text-left transition-all ".concat(o===e.id?"border-blue-500 bg-blue-50 shadow-sm":"border-gray-300 hover:border-gray-400"),children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]},e.id))})]}),(0,s.jsx)("button",{onClick:g,disabled:!e.script,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"Zero-Fault 오디오 생성"}),(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800",children:[(0,s.jsx)("p",{className:"font-medium mb-2",children:"\uD83D\uDD2C Zero-Fault Audio Loop"}),(0,s.jsxs)("ol",{className:"space-y-1 text-xs",children:[(0,s.jsx)("li",{children:"1. ElevenLabs API로 TTS 생성"}),(0,s.jsx)("li",{children:"2. OpenAI Whisper로 STT 검증"}),(0,s.jsx)("li",{children:"3. 원본과 유사도 비교 (목표: 95% 이상)"}),(0,s.jsx)("li",{children:"4. 정확도 미달 시 자동 재생성 (최대 5회)"})]})]})]}),d&&p&&(0,s.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("h4",{className:"font-medium text-blue-900 mb-1 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),"Zero-Fault 오디오 생성 중..."]}),(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"WebSocket을 통해 실시간으로 진행 상황을 추적합니다"})]}),(0,s.jsx)(u.k,{projectId:p,onCompleted:e=>{console.log("[DirectorPanel] Audio generation completed:",e),t({audio_id:e.audio_id,file_path:e.file_path,voice_id:o,duration:e.duration,stt_accuracy:e.accuracy,retry_count:e.attempt-1,created_at:new Date().toISOString()}),x(!1),a(!1),n(60)},onError:e=>{console.error("[DirectorPanel] Audio generation failed:",e),r(e||"Audio generation failed"),x(!1),a(!1)},className:"mt-4",showConnectionStatus:!0})]}),e.audio&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,s.jsx)("div",{className:"bg-green-500 rounded-full p-3",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-semibold text-green-900 mb-1",children:"오디오 생성 완료"}),(0,s.jsxs)("p",{className:"text-sm text-green-800",children:["정확도: ",(100*e.audio.stt_accuracy).toFixed(1),"% | 길이:"," ",e.audio.duration.toFixed(1),"초 | 재시도: ",e.audio.retry_count,"회"]})]})]}),(0,s.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,s.jsx)("source",{src:"http://localhost:8000".concat(e.audio.file_path),type:"audio/mpeg"}),"Your browser does not support the audio element."]})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83C\uDFAC 비디오 생성"}),(0,s.jsxs)("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-3",children:"\uD83D\uDEA7"}),(0,s.jsx)("p",{className:"text-gray-600",children:"비디오 생성 기능은 Phase 4에서 구현됩니다"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"(Google Veo + Nano Banana + HeyGen/Wav2Lip 립싱크)"})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[(0,s.jsx)("button",{onClick:()=>window.history.back(),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"← 이전"}),(0,s.jsx)("button",{disabled:!e.audio,className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"다음: 마케팅 →"})]})]})}function p(){let{state:e,setStep:t,canProceedToDirector:r,canProceedToMarketer:a,canProceedToDeployment:n}=i();(0,l.useEffect)(()=>{},[]);let o=["writer","director","marketer","deployment"];return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.projectId?(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:e.projectTitle}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.projectTopic})]}),(0,s.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium capitalize",children:e.platform})]}):(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"영상 제작"}),(0,s.jsx)("div",{className:"flex items-center justify-between",children:o.map((c,i)=>{let d=e.currentStep===c,u=o.indexOf(c)<o.indexOf(e.currentStep),m="writer"===c||"director"===c&&r||"marketer"===c&&a||"deployment"===c&&n;return(0,s.jsxs)(l.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>m&&t(c),disabled:!m,className:"flex items-center gap-3 px-4 py-2 rounded-lg transition-all ".concat(d?"bg-blue-600 text-white shadow-lg":u?"bg-green-100 text-green-800 hover:bg-green-200":m?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-gray-50 text-gray-400 cursor-not-allowed"),children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-semibold ".concat(d?"bg-white text-blue-600":u?"bg-green-500 text-white":"bg-gray-200 text-gray-600"),children:u?(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):i+1}),(0,s.jsx)("span",{className:"font-medium",children:{writer:"작가",director:"감독",marketer:"마케터",deployment:"배포"}[c]})]}),i<o.length-1&&(0,s.jsx)("div",{className:"flex-1 h-1 mx-2",children:(0,s.jsx)("div",{className:"h-full rounded transition-all ".concat(u?"bg-green-500":"bg-gray-200")})})]},c)})}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"전체 진행률"}),(0,s.jsxs)("span",{className:"text-xs font-semibold text-gray-900",children:[e.progress,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(e.progress,"%")}})})]})]})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.error&&(0,s.jsxs)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-red-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-red-900",children:"오류 발생"}),(0,s.jsx)("p",{className:"text-sm text-red-700 mt-1",children:e.error})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:["writer"===e.currentStep&&(0,s.jsx)(d,{}),"director"===e.currentStep&&(0,s.jsx)(x,{}),"marketer"===e.currentStep&&(0,s.jsx)(h,{}),"deployment"===e.currentStep&&(0,s.jsx)(g,{})]})]})]})}function h(){return(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFA8"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Marketer Agent"}),(0,s.jsx)("p",{className:"text-gray-600",children:"썸네일과 마케팅 카피를 생성하는 기능은 Phase 4에서 구현됩니다."})]})})}function g(){return(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDE80"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Deployment"}),(0,s.jsx)("p",{className:"text-gray-600",children:"플랫폼 배포 기능은 Phase 5에서 구현됩니다."})]})})}function b(){return(0,s.jsx)(c,{children:(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsx)(p,{})})})}},8716:function(e,t,r){"use strict";r.d(t,{k:function(){return a}});var s=r(3827),l=r(4090);function a(e){let{projectId:t,onCompleted:r,onError:a,className:n="",backendUrl:o="localhost:8000",showConnectionStatus:c=!0}=e,[i,d]=(0,l.useState)(0),[u,m]=(0,l.useState)(""),[x,p]=(0,l.useState)(null),[h,g]=(0,l.useState)("idle"),{isConnected:b,isFallback:j,reconnectAttempts:f}=function(e){let{projectId:t,onMessage:r,onProgress:s,onError:a,onCompleted:n,autoReconnect:o=!0,maxReconnectAttempts:c=5,pollingFallback:i=!0,pollingInterval:d=2e3,backendUrl:u="localhost:8000"}=e,[m,x]=(0,l.useState)(!1),[p,h]=(0,l.useState)(!1),[g,b]=(0,l.useState)(0),j=(0,l.useRef)(null),f=(0,l.useRef)(null),y=(0,l.useRef)(null),v=(0,l.useRef)(null),N=(0,l.useCallback)(()=>{var e;if((null===(e=j.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN)return;let l="ws://".concat(u,"/api/v1/ws/projects/").concat(t,"/stream");try{let e=new WebSocket(l);e.onopen=()=>{console.log("[WebSocket] Connected to:",l),x(!0),b(0),h(!1),y.current=setInterval(()=>{e.readyState===WebSocket.OPEN&&(e.send("ping"),console.log("[WebSocket] Ping sent"))},3e4)},e.onmessage=e=>{try{let t=JSON.parse(e.data);console.log("[WebSocket] Message received:",t),null==r||r(t),"progress"===t.type&&void 0!==t.progress&&(null==s||s(t.progress,t.message||"")),"error"===t.type&&(null==a||a(t.error||"Unknown error")),"completed"===t.type&&(null==n||n(t.result))}catch(e){console.error("[WebSocket] Failed to parse message:",e)}},e.onerror=e=>{console.error("[WebSocket] Error:",e)},e.onclose=e=>{if(console.log("[WebSocket] Closed:",e.code,e.reason),x(!1),y.current&&(clearInterval(y.current),y.current=null),o&&g<c){let e=Math.min(1e3*Math.pow(2,g),3e4);console.log("[WebSocket] Reconnecting in ".concat(e,"ms... (attempt ").concat(g+1,"/").concat(c,")")),f.current=setTimeout(()=>{b(e=>e+1),N()},e)}else i&&g>=c&&(console.log("[WebSocket] Max reconnect attempts reached. Falling back to polling..."),h(!0),w())},j.current=e}catch(e){console.error("[WebSocket] Failed to create WebSocket:",e),i&&(console.log("[WebSocket] Falling back to polling..."),h(!0),w())}},[t,g,r,s,a,n,o,c,i,u]),w=(0,l.useCallback)(()=>{if(v.current)return;let e=async()=>{try{let e=await fetch("http://".concat(u,"/api/v1/projects/").concat(t,"/status"));if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let r=await e.json();console.log("[Polling] Status received:",r);let l="number"==typeof r.progress?r.progress:0;null==s||s(l,r.message||r.status||""),"completed"===r.status&&(null==n||n(r.result||r),S()),("failed"===r.status||"error"===r.status)&&(null==a||a(r.error||"Task failed"),S())}catch(e){console.error("[Polling] Error:",e)}};e(),v.current=setInterval(e,d)},[t,s,n,a,d,u]),S=(0,l.useCallback)(()=>{v.current&&(clearInterval(v.current),v.current=null,console.log("[Polling] Stopped"))},[]),k=(0,l.useCallback)(()=>{console.log("[WebSocket] Disconnecting..."),j.current&&(j.current.close(),j.current=null),f.current&&(clearTimeout(f.current),f.current=null),y.current&&(clearInterval(y.current),y.current=null),S()},[S]);return(0,l.useEffect)(()=>(N(),()=>{k()}),[N,k]),{isConnected:m,isFallback:p,reconnectAttempts:g,disconnect:k}}({projectId:t,backendUrl:o,onProgress:(e,t)=>{d(100*e),m(t),g("running"),p(null)},onError:e=>{p(e),g("error"),null==a||a(e)},onCompleted:e=>{d(100),m("완료!"),g("completed"),null==r||r(e)},onMessage:e=>{"connected"===e.type&&g("idle")}});return(0,s.jsxs)("div",{className:"w-full ".concat(n),children:[c&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(b?"bg-green-500":j?"bg-yellow-500":f>0?"bg-orange-500":"bg-gray-400"," animate-pulse")}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:j?"폴링 모드":b?"실시간 연결":f>0?"재연결 중... (".concat(f,")"):"연결 중..."})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2 overflow-hidden",children:(0,s.jsx)("div",{className:"h-4 rounded-full transition-all duration-300 ".concat("error"===h?"bg-red-600":"completed"===h?"bg-green-600":i<30?"bg-blue-400":i<70?"bg-blue-500":"bg-blue-600"),style:{width:"".concat(i,"%")},children:"running"===h&&i<100&&(0,s.jsx)("div",{className:"h-full w-full bg-gradient-to-r from-transparent via-white to-transparent opacity-20 animate-shimmer"})})}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"".concat("error"===h?"text-red-700":"completed"===h?"text-green-700":"text-gray-700"),children:u||"대기 중..."}),(0,s.jsxs)("span",{className:"text-gray-500 font-medium",children:[i.toFixed(1),"%"]})]}),x&&(0,s.jsx)("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-semibold",children:"오류 발생"}),(0,s.jsx)("div",{className:"mt-1",children:x})]})]})}),"completed"===h&&(0,s.jsx)("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 text-green-700 rounded-md text-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"font-semibold",children:"작업이 성공적으로 완료되었습니다!"})]})})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=388)}),_N_E=e.O()}]);