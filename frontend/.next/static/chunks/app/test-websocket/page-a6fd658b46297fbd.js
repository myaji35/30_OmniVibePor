(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[976],{4111:function(e,s,t){Promise.resolve().then(t.bind(t,7152))},7152:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return n}});var l=t(3827),r=t(4090),a=t(8716);function n(){let[e,s]=(0,r.useState)(""),[t,n]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[d,i]=(0,r.useState)(null),u=()=>{if(!e.trim()){alert("Task ID를 입력하세요");return}n(!0),c(null),i(null)};return(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:(0,l.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,l.jsxs)("div",{className:"text-center mb-12",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-white mb-4",children:"WebSocket 진행률 테스트"}),(0,l.jsx)("p",{className:"text-gray-400 max-w-2xl mx-auto",children:"ProgressBar 컴포넌트와 useWebSocket 훅의 실시간 진행률 추적, 자동 재연결, 폴링 Fallback 기능을 테스트합니다."})]}),(0,l.jsxs)("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden",children:[(0,l.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"실시간 작업 모니터링"}),(0,l.jsx)("p",{className:"text-blue-100",children:"Task ID를 입력하여 백엔드 작업의 진행 상황을 추적하세요"})]}),(0,l.jsxs)("div",{className:"p-8",children:[!t&&(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"taskId",className:"block text-sm font-medium text-gray-700 mb-2",children:"Task ID"}),(0,l.jsx)("input",{id:"taskId",type:"text",value:e,onChange:e=>s(e.target.value),placeholder:"예: audio_generation_12345",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",onKeyPress:e=>"Enter"===e.key&&u()}),(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"백엔드에서 생성된 Task ID를 입력하세요"})]}),(0,l.jsx)("button",{onClick:u,className:"w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-semibold text-lg shadow-lg transition-all",children:"연결 시작"}),(0,l.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"예시 Task ID"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("button",{onClick:()=>s("test_task_001"),className:"w-full text-left px-3 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 text-sm text-gray-700",children:"test_task_001"}),(0,l.jsx)("button",{onClick:()=>s("audio_generation_12345"),className:"w-full text-left px-3 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 text-sm text-gray-700",children:"audio_generation_12345"})]})]})]}),t&&(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,l.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,l.jsx)("span",{className:"font-semibold",children:"Task ID:"})," ",e]})}),(0,l.jsx)(a.k,{projectId:e,onCompleted:e=>{console.log("[TestPage] Task completed:",e),c(e),n(!1)},onError:e=>{console.error("[TestPage] Task failed:",e),i(e)},showConnectionStatus:!0}),(0,l.jsx)("button",{onClick:()=>{s(""),n(!1),c(null),i(null)},className:"w-full px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium",children:"초기화"})]}),o&&(0,l.jsxs)("div",{className:"mt-6 bg-green-50 border border-green-200 rounded-lg p-6",children:[(0,l.jsxs)("h3",{className:"font-semibold text-green-900 mb-3 flex items-center gap-2",children:[(0,l.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"작업 완료 결과"]}),(0,l.jsx)("pre",{className:"bg-white border border-green-300 rounded p-4 text-sm text-gray-800 overflow-x-auto",children:JSON.stringify(o,null,2)})]})]})]}),(0,l.jsxs)("div",{className:"max-w-3xl mx-auto mt-12 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-lg",children:[(0,l.jsx)("div",{className:"text-3xl mb-3",children:"\uD83D\uDD04"}),(0,l.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"자동 재연결"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"연결이 끊어지면 exponential backoff 알고리즘으로 자동 재연결합니다"})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-lg",children:[(0,l.jsx)("div",{className:"text-3xl mb-3",children:"\uD83D\uDCCA"}),(0,l.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"폴링 Fallback"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"WebSocket 실패 시 자동으로 HTTP 폴링으로 전환하여 안정성을 보장합니다"})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-lg",children:[(0,l.jsx)("div",{className:"text-3xl mb-3",children:"\uD83D\uDC93"}),(0,l.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Keep-alive"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"30초마다 ping을 전송하여 연결 상태를 유지하고 타임아웃을 방지합니다"})]})]}),(0,l.jsxs)("div",{className:"max-w-3xl mx-auto mt-12 bg-gray-800 rounded-lg p-6 text-gray-100",children:[(0,l.jsxs)("h3",{className:"font-semibold text-xl mb-4 flex items-center gap-2",children:[(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"백엔드 설정 방법"]}),(0,l.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,l.jsxs)("p",{children:["1. 백엔드 서버가 ",(0,l.jsx)("code",{className:"bg-gray-700 px-2 py-1 rounded",children:"localhost:8000"}),"에서 실행 중이어야 합니다"]}),(0,l.jsxs)("p",{children:["2. WebSocket 엔드포인트: ",(0,l.jsxs)("code",{className:"bg-gray-700 px-2 py-1 rounded",children:["ws://localhost:8000/api/v1/ws/projects/","{task_id}","/stream"]})]}),(0,l.jsxs)("p",{children:["3. 폴링 엔드포인트: ",(0,l.jsxs)("code",{className:"bg-gray-700 px-2 py-1 rounded",children:["GET /api/v1/projects/","{task_id}","/status"]})]}),(0,l.jsx)("p",{className:"text-yellow-400",children:"⚠️ 백엔드에서 위 엔드포인트가 구현되어 있어야 정상 작동합니다"})]})]})]})})}},8716:function(e,s,t){"use strict";t.d(s,{k:function(){return a}});var l=t(3827),r=t(4090);function a(e){let{projectId:s,onCompleted:t,onError:a,className:n="",backendUrl:o="localhost:8000",showConnectionStatus:c=!0}=e,[d,i]=(0,r.useState)(0),[u,x]=(0,r.useState)(""),[m,g]=(0,r.useState)(null),[h,b]=(0,r.useState)("idle"),{isConnected:p,isFallback:f,reconnectAttempts:j}=function(e){let{projectId:s,onMessage:t,onProgress:l,onError:a,onCompleted:n,autoReconnect:o=!0,maxReconnectAttempts:c=5,pollingFallback:d=!0,pollingInterval:i=2e3,backendUrl:u="localhost:8000"}=e,[x,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),[b,p]=(0,r.useState)(0),f=(0,r.useRef)(null),j=(0,r.useRef)(null),v=(0,r.useRef)(null),N=(0,r.useRef)(null),y=(0,r.useCallback)(()=>{var e;if((null===(e=f.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN)return;let r="ws://".concat(u,"/api/v1/ws/projects/").concat(s,"/stream");try{let e=new WebSocket(r);e.onopen=()=>{console.log("[WebSocket] Connected to:",r),m(!0),p(0),h(!1),v.current=setInterval(()=>{e.readyState===WebSocket.OPEN&&(e.send("ping"),console.log("[WebSocket] Ping sent"))},3e4)},e.onmessage=e=>{try{let s=JSON.parse(e.data);console.log("[WebSocket] Message received:",s),null==t||t(s),"progress"===s.type&&void 0!==s.progress&&(null==l||l(s.progress,s.message||"")),"error"===s.type&&(null==a||a(s.error||"Unknown error")),"completed"===s.type&&(null==n||n(s.result))}catch(e){console.error("[WebSocket] Failed to parse message:",e)}},e.onerror=e=>{console.error("[WebSocket] Error:",e)},e.onclose=e=>{if(console.log("[WebSocket] Closed:",e.code,e.reason),m(!1),v.current&&(clearInterval(v.current),v.current=null),o&&b<c){let e=Math.min(1e3*Math.pow(2,b),3e4);console.log("[WebSocket] Reconnecting in ".concat(e,"ms... (attempt ").concat(b+1,"/").concat(c,")")),j.current=setTimeout(()=>{p(e=>e+1),y()},e)}else d&&b>=c&&(console.log("[WebSocket] Max reconnect attempts reached. Falling back to polling..."),h(!0),k())},f.current=e}catch(e){console.error("[WebSocket] Failed to create WebSocket:",e),d&&(console.log("[WebSocket] Falling back to polling..."),h(!0),k())}},[s,b,t,l,a,n,o,c,d,u]),k=(0,r.useCallback)(()=>{if(N.current)return;let e=async()=>{try{let e=await fetch("http://".concat(u,"/api/v1/projects/").concat(s,"/status"));if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let t=await e.json();console.log("[Polling] Status received:",t);let r="number"==typeof t.progress?t.progress:0;null==l||l(r,t.message||t.status||""),"completed"===t.status&&(null==n||n(t.result||t),w()),("failed"===t.status||"error"===t.status)&&(null==a||a(t.error||"Task failed"),w())}catch(e){console.error("[Polling] Error:",e)}};e(),N.current=setInterval(e,i)},[s,l,n,a,i,u]),w=(0,r.useCallback)(()=>{N.current&&(clearInterval(N.current),N.current=null,console.log("[Polling] Stopped"))},[]),S=(0,r.useCallback)(()=>{console.log("[WebSocket] Disconnecting..."),f.current&&(f.current.close(),f.current=null),j.current&&(clearTimeout(j.current),j.current=null),v.current&&(clearInterval(v.current),v.current=null),w()},[w]);return(0,r.useEffect)(()=>(y(),()=>{S()}),[y,S]),{isConnected:x,isFallback:g,reconnectAttempts:b,disconnect:S}}({projectId:s,backendUrl:o,onProgress:(e,s)=>{i(100*e),x(s),b("running"),g(null)},onError:e=>{g(e),b("error"),null==a||a(e)},onCompleted:e=>{i(100),x("완료!"),b("completed"),null==t||t(e)},onMessage:e=>{"connected"===e.type&&b("idle")}});return(0,l.jsxs)("div",{className:"w-full ".concat(n),children:[c&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(p?"bg-green-500":f?"bg-yellow-500":j>0?"bg-orange-500":"bg-gray-400"," animate-pulse")}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:f?"폴링 모드":p?"실시간 연결":j>0?"재연결 중... (".concat(j,")"):"연결 중..."})]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2 overflow-hidden",children:(0,l.jsx)("div",{className:"h-4 rounded-full transition-all duration-300 ".concat("error"===h?"bg-red-600":"completed"===h?"bg-green-600":d<30?"bg-blue-400":d<70?"bg-blue-500":"bg-blue-600"),style:{width:"".concat(d,"%")},children:"running"===h&&d<100&&(0,l.jsx)("div",{className:"h-full w-full bg-gradient-to-r from-transparent via-white to-transparent opacity-20 animate-shimmer"})})}),(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,l.jsx)("span",{className:"".concat("error"===h?"text-red-700":"completed"===h?"text-green-700":"text-gray-700"),children:u||"대기 중..."}),(0,l.jsxs)("span",{className:"text-gray-500 font-medium",children:[d.toFixed(1),"%"]})]}),m&&(0,l.jsx)("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm",children:(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[(0,l.jsx)("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"font-semibold",children:"오류 발생"}),(0,l.jsx)("div",{className:"mt-1",children:m})]})]})}),"completed"===h&&(0,l.jsx)("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 text-green-700 rounded-md text-sm",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,l.jsx)("span",{className:"font-semibold",children:"작업이 성공적으로 완료되었습니다!"})]})})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=4111)}),_N_E=e.O()}]);