# Auto Auto-Execution Command

**Usage**: `/auto "{goal}"` (예: `/auto "Phase 0 완료"`, `/auto "MVP 완성"`, `/auto "오디오 파이프라인 완성"`)

## 목적
목표만 제시하면 Claude가 계획 수립부터 실행, 검증까지 완전 자율적으로 수행합니다. `/phase` 커맨드의 상위 개념으로, 여러 Phase를 오케스트레이션하거나 REALPLAN.md에 없는 새로운 목표도 수행할 수 있습니다.

## 실행 로직

당신은 이제 **Fully Autonomous Goal Executor**로 동작합니다.

### Step 1: 목표 분석
1. 사용자가 제시한 목표(goal) 파싱
2. REALPLAN.md에서 현재 프로젝트 상태 확인
3. 목표 달성을 위해 필요한 작업 식별
4. 기존 Phase와의 매핑 여부 판단

**출력 예시**:
```
📋 목표 분석:
- 입력 목표: "Phase 0 완료"
- 현재 상태: Phase 0.0 완료, 0.1 진행 중
- 필요 작업: Phase 0.1, 0.2, 0.3 완료
- 매핑: REALPLAN.md Phase 0과 완전 일치
```

### Step 2: 실행 계획 생성
1. 목표를 Phase 단위로 분해
2. Phase 간 의존성 분석
3. 병렬 실행 가능한 Phase 그룹 식별
4. 타임라인 및 우선순위 설정

**출력 예시**:
```
🗓️ 실행 계획:

**Phase 그룹 1** (병렬 실행 가능):
- Phase 0.1: Google Sheets API 연동 테스트
- Phase 0.2: 오디오 생성 엔드투엔드 테스트

**Phase 그룹 2** (그룹 1 완료 후):
- Phase 0.3: 전체 통합 테스트

**예상 소요 시간**: 45-60분
**생성 예상 파일**: 약 25개
**수정 예상 파일**: 약 8개
```

### Step 3: 자율 실행
- **다중 Phase 오케스트레이션**: `/phase` 커맨드를 내부적으로 순차/병렬 실행
- **TodoWrite 도구 사용**: 전체 목표를 todo list로 관리
- **실시간 모니터링**: 각 Phase 진행 상황 추적
- **자동 검증**: Phase 완료 후 결과 검증
- **자동 복구**: 실패 시 분석 후 재시도 또는 계획 수정

**실행 중 출력 예시**:
```
🚀 자율 실행 시작...

[Phase 그룹 1 시작]
✅ Phase 0.1 완료 (12분 소요)
✅ Phase 0.2 완료 (18분 소요)

[Phase 그룹 2 시작]
🔄 Phase 0.3 실행 중...
⚠️  테스트 실패 감지 (app/tests/test_integration.py)
🔧 자동 수정 시도 중...
✅ Phase 0.3 완료 (8분 소요, 1회 재시도)
```

### Step 4: 검증 프로세스
Phase별 검증 후 최종 통합 검증 수행:

1. **코드 검증**
   - Linter 실행 (ruff, mypy)
   - 타입 체크 통과
   - Import 순환 참조 체크

2. **테스트 검증**
   - 유닛 테스트 실행
   - 통합 테스트 실행
   - 커버리지 80% 이상 확인

3. **서비스 검증**
   - Docker Compose 빌드 테스트
   - Health Check 엔드포인트 검증
   - 외부 API 연동 테스트

4. **문서 검증**
   - REALPLAN.md 업데이트 확인
   - API 문서 동기화 확인
   - CLAUDE.md 패턴 업데이트

**검증 출력 예시**:
```
🔍 최종 검증 중...

✅ 코드 검증: 통과 (0 errors, 2 warnings)
✅ 테스트 검증: 통과 (45/45 tests, 87% coverage)
✅ 서비스 검증: 통과 (모든 컨테이너 정상)
✅ 문서 검증: 통과 (REALPLAN.md 업데이트됨)
```

### Step 5: 최종 보고
목표 달성 후 종합 리포트 생성:

```
🎉 목표 달성: "Phase 0 완료"

**실행 요약**:
- 총 실행 Phase: 3개 (0.1, 0.2, 0.3)
- 총 실행 시간: 38분
- 성공률: 100% (1회 자동 복구)

**생성 파일** (24개):
- app/api/v1/sheets.py
- app/services/google_sheets_service.py
- app/services/audio_correction_loop.py
- app/tests/test_sheets_integration.py
- app/tests/test_audio_e2e.py
- ... (19 more files)

**수정 파일** (7개):
- app/main.py (라우터 추가)
- app/core/config.py (환경 변수 추가)
- pyproject.toml (의존성 추가)
- docker-compose.yml (볼륨 추가)
- ... (3 more files)

**테스트 결과**:
- 유닛 테스트: 32 passed
- 통합 테스트: 13 passed
- 커버리지: 87%

**다음 단계 제안**:
1. Phase 1 시작: Writer Agent 구현
2. 또는 `/auto "Writer Agent 완성"` 실행
3. 또는 `/phase 1.1` 부터 단계별 진행
```

## 자율 실행 권한

`/auto` 커맨드는 `/phase`의 모든 권한 + 다음 추가 권한을 가집니다:

### 1. 아키텍처 변경 권한
- **허용**: 새로운 서비스 추가, 모듈 구조 변경
- **조건**: 변경 전 사용자에게 알림 및 30초 대기
- **예시**: "새로운 에이전트 추가를 위해 app/agents/ 디렉토리를 생성합니다"

### 2. 데이터베이스 스키마 변경 권한
- **허용**: Neo4j 그래프 스키마 변경, 인덱스 추가
- **조건**: 자동 백업 생성 후 변경
- **롤백**: 실패 시 자동 롤백 스크립트 실행

### 3. API 계약 변경 권한
- **허용**: 엔드포인트 추가, 응답 스키마 변경
- **조건**: 버전 관리 적용 (v1, v2 등)
- **예외**: 기존 엔드포인트 제거는 사용자 확인 필요

### 4. 다중 Phase 오케스트레이션 권한
- **허용**: 여러 Phase를 동시 또는 순차 실행
- **제한**: 한 번에 최대 10개 Phase까지
- **최적화**: 병렬 실행 가능한 Phase 자동 식별

### 5. 의존성 관리 권한
- **허용**: pyproject.toml, package.json 자동 업데이트
- **조건**: 보안 취약점 없는 버전 사용
- **알림**: 메이저 버전 업그레이드 시 사용자 확인

## 자동 복구 로직

실패 발생 시 다음 프로세스를 따릅니다:

### 1단계: 실패 원인 분석
```
⚠️  Phase 0.2 실패 감지
🔍 원인 분석 중...

**실패 지점**: app/services/audio_correction_loop.py:45
**에러 유형**: ImportError
**근본 원인**: elevenlabs 패키지 미설치
```

### 2단계: 계획 수정 여부 판단
- **수정 불필요**: 일시적 에러 (네트워크, API 제한 등) → 재시도
- **수정 필요**: 구조적 에러 (의존성 누락, 설계 오류 등) → 계획 수정

### 3단계: 다른 접근법 시도
```
🔧 수정 계획:
1. pyproject.toml에 elevenlabs 패키지 추가
2. poetry install 실행
3. Phase 0.2 재시도

🚀 수정 실행 중...
```

### 4단계: 재시도 제한
- **최대 재시도**: 동일 Phase당 3회
- **계획 수정**: 최대 3회 반복
- **에스컬레이션**: 3회 실패 시 사용자에게 보고

### 5단계: 사용자 에스컬레이션
```
🚨 자동 복구 실패

**시도한 방법**:
1. 패키지 재설치 (실패)
2. 캐시 클리어 후 재설치 (실패)
3. Python 가상환경 재생성 (실패)

**추정 원인**: Apple Silicon 호환성 문제

**제안 해결책**:
1. Rosetta 모드로 Poetry 재설치
2. 또는 elevenlabs 대신 다른 TTS 서비스 사용

대표님, 어떤 방법을 선택하시겠습니까?
```

## 실행 예시

### 예시 1: Phase 완료
```
대표님: /auto "Phase 0 완료"

AI:
📋 목표 분석 완료
- Phase 0.1, 0.2, 0.3 실행 필요
- 예상 시간: 45분

🚀 자율 실행 시작...

[38분 후]

🎉 Phase 0 완료!
- 24개 파일 생성
- 7개 파일 수정
- 테스트 커버리지: 87%

다음 단계: Phase 1 시작 가능
```

### 예시 2: MVP 완성
```
대표님: /auto "MVP 완성"

AI:
📋 목표 분석 완료
- MVP = Phase 0 + Phase 1 + Phase 2 + 기본 프론트엔드
- REALPLAN.md 기준 약 8개 Phase
- 예상 시간: 4-6시간

⚠️  대규모 작업입니다. 계속 진행하시겠습니까? (yes/no)

대표님: yes

AI:
🗓️ 실행 계획:

**그룹 1**: Phase 0 (기반 시스템)
**그룹 2**: Phase 1 (Writer Agent)
**그룹 3**: Phase 2 (Director Agent)
**그룹 4**: Phase 3 (기본 프론트엔드)

🚀 자율 실행 시작...

[진행 상황 실시간 업데이트]
✅ 그룹 1 완료 (38분)
✅ 그룹 2 완료 (1시간 12분)
🔄 그룹 3 실행 중 (47% 완료)...
```

### 예시 3: 특정 기능 구현
```
대표님: /auto "Zero-Fault Audio Loop 완성"

AI:
📋 목표 분석 완료
- REALPLAN.md에 명시된 핵심 기능
- 필요 Phase: 0.2 (오디오 E2E) + 일부 Phase 1
- 예상 시간: 1시간

🗓️ 실행 계획:

**Phase 1**: 오디오 생성 서비스 구현
- ElevenLabs TTS 연동
- OpenAI Whisper STT 연동
- 텍스트 정규화 서비스

**Phase 2**: 보정 루프 구현
- 원본 대조 로직
- 발음 오류 감지
- 재생성 트리거

**Phase 3**: 통합 테스트
- 30초/60초/180초 테스트
- 정확도 검증 (95% 기준)

🚀 자율 실행 시작...
```

## 안전 규칙

### 1. 파괴적 작업 전 알림
다음 작업 전 반드시 사용자에게 알림 후 30초 대기:
- 데이터베이스 스키마 변경
- 프로덕션 환경 설정 변경
- 기존 API 엔드포인트 제거
- Git 히스토리 변경 (rebase, force push 등)

**알림 형식**:
```
⚠️  파괴적 작업 감지

**작업**: Neo4j 그래프 스키마 변경
**영향**: 기존 데이터 마이그레이션 필요
**백업**: 자동 백업 생성 완료

30초 내 응답 없으면 자동 진행합니다...
(취소하려면 "stop" 입력)
```

### 2. 자동 백업 생성
다음 작업 전 자동 백업:
- 데이터베이스 변경
- .env 파일 수정
- docker-compose.yml 변경
- 중요 설정 파일 수정

**백업 위치**: `/backups/{timestamp}/`

### 3. Phase 실행 제한
- **최대 Phase 수**: 한 번에 10개까지
- **예외**: 사용자가 명시적으로 제한 해제 요청 시
- **이유**: 긴 작업은 진행 상황 확인 및 중간 개입 기회 제공

### 4. 목표 모호성 처리
목표가 모호하거나 여러 해석이 가능한 경우:

```
❓ 목표 명확화 필요

입력 목표: "시스템 개선"

**가능한 해석**:
1. 성능 최적화 (캐싱, 쿼리 개선 등)
2. 코드 품질 개선 (리팩토링, 타입 힌트 등)
3. 기능 추가 (새로운 에이전트, API 등)
4. 인프라 개선 (Docker, CI/CD 등)

대표님, 어떤 의미로 사용하셨나요?
```

### 5. 비용 추정 및 확인
외부 API 호출이 많은 작업의 경우:

```
💰 예상 비용 안내

**목표**: "1000개 영상 생성"
**예상 API 비용**:
- ElevenLabs TTS: $250
- OpenAI Whisper: $50
- Google Veo: $1,500
- 총 예상: $1,800

**확인**: 계속 진행하시겠습니까? (yes/no)
```

## 메타 학습 및 최적화

각 `/auto` 실행 후 자동으로 학습 데이터 수집:

### 1. 실행 패턴 학습
```yaml
# .claude/auto_patterns.yml (자동 생성)
goal_patterns:
  - goal: "Phase 0 완료"
    avg_time: 38min
    success_rate: 95%
    common_issues:
      - elevenlabs 패키지 호환성
      - Google Sheets API 인증

  - goal: "MVP 완성"
    avg_time: 4.5h
    success_rate: 85%
    common_issues:
      - Neo4j 초기화 타이밍
      - Docker 빌드 캐시
```

### 2. 에러 패턴 DB 구축
반복되는 에러와 해결책을 CLAUDE.md에 자동 추가:

```markdown
## Auto Command Learned Patterns

### ImportError: elevenlabs
**원인**: Apple Silicon 호환성
**해결**: `pip install elevenlabs --no-binary :all:`

### Neo4j 연결 실패
**원인**: Docker 컨테이너 시작 순서
**해결**: depends_on + healthcheck 조합
```

### 3. 최적화 제안
실행 데이터 기반 자동 제안:

```
💡 최적화 제안

지난 5회 "/auto" 실행 분석 결과:
- Phase 0.1, 0.2는 항상 함께 실행됨
- Phase 0.2와 1.1은 병렬 실행 가능

**제안**: Phase 그룹 재구성으로 20% 시간 단축 가능
REALPLAN.md 업데이트를 원하시면 "/optimize-plan" 실행
```

## 제한사항

1. **동시 실행**: 한 번에 하나의 `/auto` 명령만 실행 가능
2. **외부 의존성**: 외부 API 장애 시 자동 복구 제한적
3. **하드웨어 제약**: 로컬 리소스(CPU, 메모리) 부족 시 일시 중지
4. **수동 개입 필요**: 비즈니스 로직 결정은 사용자 확인 필요

## 고급 사용법

### 조건부 실행
```
/auto "Phase 0 완료, 단 테스트 실패 시 중단"
```

### 부분 목표
```
/auto "Writer Agent만 완성 (Marketer 제외)"
```

### 시간 제한
```
/auto "1시간 내 최대한 진행"
```

### 우선순위 지정
```
/auto "MVP 완성, 프론트엔드 우선"
```

---

**참고**: `/auto`는 강력한 도구입니다. 처음 사용 시 작은 목표로 시작하여 동작을 확인한 후 점진적으로 확장하시기 바랍니다.
